parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"Tfx0":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;const e={Entify:{},globals:{},workerCount:0,async destroyWorker(r){await r.terminate(),e.workerCount--},createWorkers(r=5,o){let t=new Array(r);for(var s=0;s<r;s++)t[s]=new Worker(o);return e.workerCount+=r,t},doWork:(r,o,t)=>new Promise((s,n)=>{r.onmessage=s,r.onerror=n,r.postMessage({chunk:o,allData:t,fps:e.Entify.fps,globals:JSON.stringify(e.globals)})}),doInit(e,r,o){const t=o?[o]:void 0;return new Promise((s,n)=>{e.onmessage=s,e.onerror=n,e.postMessage({init:!0,data:r,transferrables:o},t)})},doDistributedWork(r,o){var t=o.length/r.length;return Promise.all(r.map((r,s)=>{const n=s*t,a=e.doWork(r,o.slice(n,n+t),o);return r.promise=a,a}))}};var r=e;exports.default=r;
},{}],"KKFU":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=e(require("./workers.js"));function e(t){return t&&t.__esModule?t:{default:t}}const o={};t.default.Entify=o,o.globals={},o.allEntities=[],o.Entity=function(){return this.id=(+new Date).toString(16)+(1e8*Math.random()|0).toString(16)+o.Entity.prototype.count,o.Entity.prototype.count++,this.components={},o.allEntities.push(this),this},o.Entity.prototype.count=0,o.Entity.destroy=function(t){const e=o.allEntities.findIndex(e=>e.id===t);e&&o.allEntities.splice(e,1)},o.Entity.prototype.print=function(){return console.log(JSON.stringify(this,null,4)),this},o.Entity.prototype.addComponent=function(t){return this.components[t.name]=t,this},o.Entity.prototype.removeComponent=function(t){var e=t;return"function"==typeof t&&(e=t.prototype.name),delete this.components[e],this},o.Components={},o.AllSystems=[],o.System=function(t){return this.setName(t),this.work=(()=>{}),this.setup=(()=>{}),this.postSetup=(()=>{}),this.cleanup=(()=>{}),this.globals=o.globals,o.AllSystems.push(this),this},o.System.prototype.setName=function(t){return this.name=t,this},o.System.prototype.workify=function(e,s,n){const i=this.setup.bind(this);this.setup=(async()=>{await i(),this.workers&&this.workers.length&&(this.workers.forEach(t=>{t.terminate()}),this.workers.length=0);const r=s||o.globals.workerCount;if(t.default.globals=o.globals,this.workers=t.default.createWorkers(r,e),n)for(let e of this.workers){const o=n();o&&await t.default.doInit(e,o.data,o.transferrables)}else;}),this.oldWork=this.work,this.work=(async()=>(await this.oldWork(),await t.default.doDistributedWork(this.workers,o.allEntities).then(t=>{let e=[];return t.forEach(t=>{e=e.concat(t.data)}),o.allEntities=e,t}))),this.oldCleanup=this.cleanup,this.cleanup=(async()=>{if(await this.oldCleanup(),this.workers&&this.workers.length){for(const t of this.workers)await t.promise;for(const e of this.workers)await t.default.destroyWorker(e);this.workers.length=0}})},o.start=(async()=>{for(const t of o.startSystems)await t.work(o.allEntities);for(const t of o.loopSystems)await t.setup();o.playing=!0,window.requestAnimationFrame(o.loop)}),o.restart=(async()=>{o.playing=!1,await o.reset(),window.requestAnimationFrame(o.start)}),o.pause=(()=>{o.playing=!1}),o.play=(()=>{o.playing=!0,window.requestAnimationFrame(o.loop)}),o.reset=(async()=>{for(const t of o.startSystems)await t.cleanup();for(const t of o.loopSystems)await t.cleanup();o.allEntities.length=0});let s=performance.now();o.loop=(async()=>{for(let s of o.loopSystems)await s.work(o.allEntities);const t=performance.now(),e=t-s;o.deltaTime=e;const n=e/1e3;o.fps=Math.round(1/n),s=t,o.playing&&window.requestAnimationFrame(o.loop)});var n=o;exports.default=n;
},{"./workers.js":"Tfx0"}],"lWcS":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;const t={Color:function(t=0,o=0,i=0){return this.h=t,this.s=o,this.l=i,this}};t.Color.prototype.name="color",t.Position=function(t=0,o=0){return this.x=t,this.y=o,this},t.Position.prototype.name="position",t.Size=function(t=.1){return this.radius=t,this},t.Size.prototype.name="size",t.Velocity=function(t=1,o=1){return this.x=t,this.y=o,this},t.Velocity.prototype.name="velocity";var o=t;exports.default=o;
},{}],"gJo9":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=n(require("../../Entify.js")),t=n(require("./components.js"));function n(e){return e&&e.__esModule?e:{default:e}}const o={Dot:function(n,o,d,u){let r=new e.default.Entity,a=o.h||0,l=o.s||0,i=o.l||0,s=d.y,f=d.x,p=u.x,c=u.y;return r.addComponent(new t.default.Color(a,l,i)),r.addComponent(new t.default.Size(n)),r.addComponent(new t.default.Position(f,s)),r.addComponent(new t.default.Velocity(p,c)),r}};var d=o;exports.default=d;
},{"../../Entify.js":"KKFU","./components.js":"lWcS"}],"Y/Oq":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;const t={getRandomInt:t=>Math.floor(Math.random()*Math.floor(t)),clamp:(t,e,a)=>Math.min(Math.max(a,t),e)};var e=t;exports.default=e;
},{}],"IbsW":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=s(require("../../Entify.js")),t=s(require("./assemblages.js")),l=s(require("./util.js"));function s(e){return e&&e.__esModule?e:{default:e}}const o=l.default.getRandomInt,a=new e.default.System("generator");a.work=(()=>{console.warn(c.width,c.height);let e=a.numDots,s=c.width/c.height,r=Math.ceil(Math.sqrt(e*s)),n=Math.ceil(Math.sqrt(e/s)),f=c.width/r,d=c.height/n,i=0,u=0;for(;e--;){const e={h:o(360),s:"60%",l:"50%"},s=o(10)+3;u<r?u++:(u=0,i++);const a={x:l.default.clamp(15,c.width-15,(i+1)*d),y:l.default.clamp(15,c.height-15,(u+1)*f)},n=o(1)?1:-1,h=o(1)?1:-1,p={x:o(6)+1*n,y:o(6)+1*h};new t.default.Dot(s,e,a,p)}});const r=new e.default.System("collider");r.workify("collider.js");const n=new e.default.System("mover");n.workify("mover.js");const f=new e.default.System("drawer");f.setup=(async()=>{if(!e.default.globals.offscreen)return e.default.globals.ctx=e.default.globals.c.getContext("2d",{alpha:!0}),void(f.perfCounter=0)}),f.work=(async()=>{if(!e.default.globals.offscreen){const t=e.default.globals.ctx;f.perfCounter++,t.clearRect(0,0,e.default.globals.c.width,e.default.globals.c.height),e.default.allEntities.forEach(e=>{const l=e.components.color,s=e.components.size,o=e.components.position;t.beginPath(),t.fillStyle=`hsl(${l.h}, ${l.s}, ${l.l})`,t.strokeStyle=`hsl(${l.h+180}, ${l.s}, ${l.l})`,t.arc(o.x,o.y,s.radius,0,2*Math.PI),t.stroke(),t.fill()}),(f.perfCounter%30==0||!f.perfText&&e.default.fps)&&(f.perfCounter=0,f.perfText=e.default.fps+" fps"),t.font="32px helvetica",t.fillStyle="#fff",t.fillText(f.perfText,10,50)}return e.default.allEntities}),f.workify("drawer.js",1,()=>{if(e.default.globals.offscreen){const t=e.default.globals.c,l=t.cloneNode(),s=t.parentNode;s.removeChild(t),s.appendChild(l),e.default.globals.c=l;const o=e.default.globals.c.transferControlToOffscreen();return{data:o,transferrables:o}}return!1});const d=new e.default.System("clicker");d.work=(async()=>{d.clicks.forEach(l=>{if(0===l[2]){const e=o(10)+3,s={h:o(360),s:"60%",l:"50%"},a={x:l[0],y:l[1]},r=o(1)?1:-1,n=o(1)?1:-1,c={x:o(6)+1*r,y:o(6)+1*n};new t.default.Dot(e,s,a,c)}else 2===l[2]&&e.default.allEntities.forEach(t=>{const[s,o]=l,{x:a,y:r}=t.components.position,{radius:n}=t.components.size;Math.hypot(s-a,o-r)<=1+n&&e.default.Entity.destroy(t.id)})}),d.clicks.length=0}),d.setup=(()=>{let t=!1;d.clicks=[],e.default.globals.c.addEventListener("mousedown",e=>{t=e.button,d.clicks.push([e.layerX,e.layerY,e.button])}),e.default.globals.c.addEventListener("mousemove",e=>{0!==t&&2!==t||d.clicks.push([e.layerX,e.layerY,t])}),e.default.globals.c.addEventListener("mouseup",()=>{t=!1}),e.default.globals.c.addEventListener("contextmenu",function(e){e.preventDefault()})});var i={generatorSystem:a,colliderSystem:r,moverSystem:n,drawerSystem:f,clickerSystem:d};exports.default=i;
},{"../../Entify.js":"KKFU","./assemblages.js":"gJo9","./util.js":"Y/Oq"}],"Focm":[function(require,module,exports) {
"use strict";var e=l(require("../../Entify.js")),t=l(require("./systems.js"));function l(e){return e&&e.__esModule?e:{default:e}}let a,r="&#10074; &#10074;",u="&#9654;";e.default.globals.width=800,e.default.globals.height=600,(a=document.getElementById("c")).width=e.default.globals.width,a.height=e.default.globals.height,a.transferControlToOffscreen?e.default.globals.offscreen=!0:e.default.globals.offscreen=!1,e.default.globals.c=a,t.default.generatorSystem.numDots=200,e.default.startSystems=[t.default.generatorSystem],e.default.loopSystems=[t.default.colliderSystem,t.default.moverSystem,t.default.drawerSystem,t.default.clickerSystem],e.default.start(),document.querySelector("#pause").addEventListener("click",t=>{e.default.playing?(e.default.pause(),t.target.innerHTML=u):(e.default.play(),t.target.innerHTML=r)}),document.querySelector("#restart").addEventListener("click",async()=>{e.default.pause(),t.default.generatorSystem.numDots=parseInt(document.querySelector("#dotsInput").value),e.default.globals.workerCount=parseInt(document.querySelector("#workersInput").value),e.default.restart(),document.querySelector("#pause").innerHTML=r});
},{"../../Entify.js":"KKFU","./systems.js":"IbsW"}]},{},["Focm"], null)
//# sourceMappingURL=bouncyballs.9903b287.js.map