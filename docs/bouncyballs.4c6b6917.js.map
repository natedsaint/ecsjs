{"version":3,"sources":["../../workers.js","../../Entify.js","components.js","assemblages.js","util.js","systems.js","index.js"],"names":["Workers","Entify","globals","workerCount","destroyWorker","worker","terminate","createWorkers","numWorkers","src","workers","Array","i","Worker","doWork","data","allData","Promise","resolve","reject","onmessage","onerror","postMessage","chunk","fps","JSON","stringify","doInit","transferrables","tfer","undefined","init","doDistributedWork","elementsPerWorker","length","all","map","index","start","promise","slice","allEntities","Entity","id","Date","toString","Math","random","prototype","count","components","push","destroy","idx","findIndex","entity","splice","print","console","log","addComponent","component","name","removeComponent","componentName","Components","AllSystems","System","setName","work","setup","postSetup","cleanup","workify","workerScript","numberOfWorkers","getInitData","oldSetup","bind","forEach","initData","oldWork","then","results","entities","event","concat","oldCleanup","system","startSystems","loopSystems","playing","window","requestAnimationFrame","loop","restart","reset","pause","play","stamp","performance","now","newStamp","delta","deltaTime","deltaSeconds","round","h","s","l","Color","Position","x","y","Size","radius","Velocity","Assemblages","Dot","size","color","position","velocity","hue","saturation","luminance","posY","posX","velX","velY","Utils","getRandomInt","max","floor","generatorSystem","numDots","ratio","c","width","height","cols","ceil","sqrt","rows","pixelsPerCol","pixelsPerRow","row","col","xSign","ySign","colliderSystem","moverSystem","drawerSystem","offscreen","ctx","getContext","alpha","perfCounter","clearRect","beginPath","fillStyle","strokeStyle","arc","PI","stroke","fill","perfText","font","fillText","canvas","newCanvas","cloneNode","canvasParent","parentNode","removeChild","appendChild","transferControlToOffscreen","clickerSystem","clicks","click","dot","mouseX","mouseY","hypot","mousedown","addEventListener","button","layerX","layerY","e","preventDefault","PAUSE_TXT","PLAY_TXT","document","getElementById","Systems","querySelector","target","innerHTML","parseInt","value"],"mappings":"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","file":"bouncyballs.4c6b6917.js","sourceRoot":"../src/examples/bouncyballs","sourcesContent":["const Workers = {\n  Entify: {},\n  globals: {},\n  workerCount: 0,\n  async destroyWorker(worker) {\n    await worker.terminate();\n    Workers.workerCount--;\n    return;\n  },\n  createWorkers(numWorkers=5, src) {\n    let workers = new Array(numWorkers);\n    for (var i = 0; i < numWorkers; i++) {\n      workers[i] = new Worker(src);\n    }\n    Workers.workerCount += numWorkers;\n    return workers;\n  },\n  doWork(worker, data, allData) {\n    return new Promise((resolve, reject) => {\n      worker.onmessage = resolve;\n      worker.onerror = reject;\n      worker.postMessage({ \n        chunk: data,\n        allData,\n        fps: Workers.Entify.fps,\n        globals: JSON.stringify(Workers.globals),\n      });\n    });\n  },\n  doInit(worker, data, transferrables) {\n    const tfer = (transferrables) ? [transferrables] : undefined;\n    return new Promise((resolve, reject) => {\n      worker.onmessage = resolve;\n      worker.onerror = reject;\n      worker.postMessage({\n        init: true,\n        data,\n        transferrables,\n      }, tfer);\n    });\n  },\n  doDistributedWork(workers, data) {\n    // data size is always a multiple of the number of workers\n    var elementsPerWorker = data.length / workers.length;\n    return Promise.all(workers.map((worker, index) => {\n      const start = index * elementsPerWorker;\n      const promise = Workers.doWork(worker, data.slice(start, start+elementsPerWorker), data);\n      worker.promise = promise;\n      return promise;\n    }));\n  }\n};\n\nexport default Workers;","import Workers from './workers.js';\nconst Entify = {};\nWorkers.Entify = Entify;\n\n// namespace to store some stuff to get passed to all systems and their workers\nEntify.globals = {};\n\n// E\nEntify.allEntities = [];\nEntify.Entity = function () {\n  this.id = (+new Date()).toString(16) + \n  (Math.random() * 100000000 | 0).toString(16) +\n  Entify.Entity.prototype.count;\n  Entify.Entity.prototype.count++;\n  this.components = {};\n  Entify.allEntities.push(this);\n  return this;\n};\nEntify.Entity.prototype.count = 0;\n\nEntify.Entity.destroy = function(id) {\n  const idx = Entify.allEntities.findIndex((entity) => {\n    return entity.id === id;\n  });\n  if (idx) {\n    Entify.allEntities.splice(idx, 1);\n  }\n};\n\nEntify.Entity.prototype.print = function () {\n  console.log(JSON.stringify(this, null, 4));\n  return this;\n};\n\n// C\nEntify.Entity.prototype.addComponent = function ( component ){\n  this.components[component.name] = component;\n  return this;\n};\n\nEntify.Entity.prototype.removeComponent = function ( componentName ){\n  var name = componentName; // assume a string was passed in\n\n  if(typeof componentName === 'function'){ \n    name = componentName.prototype.name;\n  }\n\n  delete this.components[name];\n  return this;\n};\n\nEntify.Components = {}; \n\n// S\nEntify.AllSystems = [];\nEntify.System = function(name) {\n  this.setName(name);\n  this.work = () => {};\n  this.setup = () => {};\n  this.postSetup = () => {};\n  this.cleanup = () => {};\n  this.globals = Entify.globals; // systems can use this directly but just in case, make a reference\n  Entify.AllSystems.push(this);\n  return this;\n};\n\nEntify.System.prototype.setName = function(name) {\n  this.name = name;\n  return this;\n};\n\n// NOTE: this overrides the setup, cleanup and work functions\n// initData is thunk that returns an object in the form \n//   {data: data, transferrables: transferrables}\nEntify.System.prototype.workify = function(workerScript, numberOfWorkers, getInitData) {\n  const oldSetup = this.setup.bind(this);\n  this.setup = async () => {\n    await oldSetup();\n    if (this.workers && this.workers.length) {\n      this.workers.forEach((worker) => {\n        worker.terminate();\n      });\n      this.workers.length = 0;\n    }\n    const numWorkers = numberOfWorkers || Entify.globals.workerCount;\n    Workers.globals = Entify.globals;\n    this.workers = Workers.createWorkers(numWorkers, workerScript);\n    // in the event your worker(s) need initialization\n    if (getInitData) {\n      for (let worker of this.workers) {\n        const initData = getInitData();\n        if (initData) {\n          await Workers.doInit(worker, initData.data, initData.transferrables);\n        }\n      }\n      return;\n    } else {\n      return;\n    }\n  };\n\n  this.oldWork = this.work;\n  this.work = async () => {\n    await this.oldWork();\n    return await Workers.doDistributedWork(this.workers, Entify.allEntities)\n      .then((results) => {\n        let entities = [];\n        results.forEach((event) => {\n          entities = entities.concat(event.data);\n        });\n        Entify.allEntities = entities;\n        return results;\n      });\n  };\n\n  this.oldCleanup = this.cleanup;\n  this.cleanup = async () => {\n    await this.oldCleanup();\n    if (this.workers && this.workers.length) {\n      for (const worker of this.workers) {\n        await worker.promise;\n      }\n      for (const worker of this.workers) {\n        await Workers.destroyWorker(worker);\n      }\n      this.workers.length = 0;\n    }\n    return;\n  };\n};\n\nEntify.start = async () => {\n  for (const system of Entify.startSystems) {\n    await system.work(Entify.allEntities);\n  }\n  for (const system of Entify.loopSystems) {\n    await system.setup();\n  }\n  Entify.playing = true;\n  window.requestAnimationFrame(Entify.loop);\n};\n\nEntify.restart = async () => {\n  Entify.playing = false;\n  await Entify.reset();\n  window.requestAnimationFrame(Entify.start);\n};\n\nEntify.pause = () => {\n  Entify.playing = false;\n};\n\nEntify.play = () => {\n  Entify.playing = true;\n  window.requestAnimationFrame(Entify.loop);\n};\n\nEntify.reset = async () => {\n  for (const system of Entify.startSystems) {\n    await system.cleanup();\n  }\n  for (const system of Entify.loopSystems) {\n    await system.cleanup();\n  }\n  Entify.allEntities.length = 0;\n  return;\n};\n\n// now do work with the update loops\nlet stamp = performance.now();\n\nEntify.loop = async () => {\n  for (let system of Entify.loopSystems) {\n    await system.work(Entify.allEntities);\n  }\n  const newStamp = performance.now();\n  const delta = (newStamp - stamp);\n  Entify.deltaTime = delta;\n  const deltaSeconds = delta / 1000;\n  Entify.fps = Math.round(1/deltaSeconds);\n  stamp = newStamp;\n  if (Entify.playing) {\n    window.requestAnimationFrame(Entify.loop);\n  }\n};\n\nexport default Entify;","// Components\nconst Components = {};\n\nComponents.Color = function(h = 0, s = 0, l = 0) {\n  this.h = h;\n  this.s = s;\n  this.l = l;\n  return this;\n};\n\nComponents.Color.prototype.name = 'color';\n\nComponents.Position = function(x=0, y=0) {\n  this.x = x;\n  this.y = y;\n  return this;\n};\n\nComponents.Position.prototype.name = 'position';\n\nComponents.Size = function(radius=0.1) {\n  this.radius = radius;\n  return this;\n};\n\nComponents.Size.prototype.name = 'size';\n\nComponents.Velocity = function(x = 1, y = 1) {\n  this.x = x;\n  this.y = y;\n  return this;\n}; \n\nComponents.Velocity.prototype.name = 'velocity';\n\nexport default Components;","import Entify from '../../Entify.js';\nimport Components from './components.js';\nconst Assemblages = {\n  Dot: function(size, color, position, velocity) {\n    let entity = new Entify.Entity();\n    let hue = color.h || 0;\n    let saturation = color.s || 0;\n    let luminance = color.l || 0;\n    let posY = position.y;\n    let posX = position.x;\n    let velX = velocity.x;\n    let velY = velocity.y;\n    entity.addComponent(new Components.Color(hue, saturation, luminance));\n    entity.addComponent(new Components.Size(size));\n    entity.addComponent(new Components.Position(posX,posY));\n    entity.addComponent(new Components.Velocity(velX, velY));\n    return entity;\n  }\n};\n\nexport default Assemblages;","const Utils = {\n  getRandomInt(max) {\n    return Math.floor(Math.random() * Math.floor(max));\n  },\n};\n\nexport default Utils;","import Entify from '../../Entify.js';\nimport Assemblages from './assemblages.js';\nimport Utils from './util.js';\n\nconst getRandomInt = Utils.getRandomInt;\n\n// setup configs\n\nconst generatorSystem = new Entify.System('generator');\n\ngeneratorSystem.work = () => {\n  let numDots = generatorSystem.numDots;\n  let ratio = c.width / c.height;\n  let cols = Math.ceil(Math.sqrt(numDots * ratio));\n  let rows = Math.ceil(Math.sqrt(numDots / ratio));\n  let pixelsPerCol = c.width/cols;\n  let pixelsPerRow = c.height/rows;\n  let row = 0;\n  let col = 0;\n  while (numDots--) {\n    const color = {\n      h : getRandomInt(360),\n      s : '60%', \n      l : '50%',\n    };\n    const size = getRandomInt(10) + 3;\n    if (col < cols) {\n      col++;\n    } else {\n      col = 0;\n      row++;\n    }\n    const x = ( row + 1 ) * pixelsPerRow + 15;\n    const y = ( col + 1 ) * pixelsPerCol + 15;\n    const position = { x, y };\n    const xSign = (!!getRandomInt(1)) ? 1 : -1;\n    const ySign = (!!getRandomInt(1)) ? 1 : -1;\n    const velocity = {\n      x: getRandomInt(6) + 1 * xSign,\n      y: getRandomInt(6) + 1 * ySign,\n    };\n    new Assemblages.Dot(size, color, position, velocity);\n  }\n};\n\nconst colliderSystem = new Entify.System('collider');\n\ncolliderSystem.workify('collider.js');\n\nconst moverSystem = new Entify.System('mover');\n\nmoverSystem.workify('mover.js');\n\nconst drawerSystem = new Entify.System('drawer');\n\ndrawerSystem.setup = async () => {\n  if (!Entify.globals.offscreen) {\n    Entify.globals.ctx = Entify.globals.c.getContext('2d', { alpha: true });\n    drawerSystem.perfCounter = 0;\n    return;\n  }\n};\n\ndrawerSystem.work = async () => {\n  if (!Entify.globals.offscreen) {\n    const ctx = Entify.globals.ctx;\n    drawerSystem.perfCounter++;\n    ctx.clearRect(0,0,Entify.globals.c.width,Entify.globals.c.height);\n    Entify.allEntities.forEach((entity) => {\n      const color = entity.components.color;\n      const size = entity.components.size;\n      const position = entity.components.position;\n      ctx.beginPath();\n      ctx.fillStyle = `hsl(${color.h}, ${color.s}, ${color.l})`;\n      ctx.strokeStyle = `hsl(${color.h + 180}, ${color.s}, ${color.l})`;\n      ctx.arc(position.x, position.y, size.radius, 0, 2 * Math.PI);\n      ctx.stroke();\n      ctx.fill();\n    });\n    if (drawerSystem.perfCounter % 30 === 0 ||\n      (!drawerSystem.perfText && Entify.fps)) {\n      drawerSystem.perfCounter = 0;\n      drawerSystem.perfText = Entify.fps + ' fps';\n    }\n    ctx.font = '32px helvetica';\n    ctx.fillStyle = '#fff';\n    ctx.fillText(drawerSystem.perfText, 10, 50);\n  }\n  return Entify.allEntities;\n};\n\n// you can't transfer the offscreen canvas to multiple workers... yet?\n// you also have make a new canvas to pass to the new worker thread\ndrawerSystem.workify('drawer.js', 1, () => {\n  if (Entify.globals.offscreen) {\n    const canvas = Entify.globals.c;\n    const newCanvas = canvas.cloneNode();\n    const canvasParent = canvas.parentNode;\n    canvasParent.removeChild(canvas);\n    canvasParent.appendChild(newCanvas);\n    Entify.globals.c = newCanvas;\n  \n    const offscreen = Entify.globals.c.transferControlToOffscreen();\n    return {\n      data: offscreen, \n      transferrables: offscreen,\n    };\n  }\n  return false;\n});\n\nconst clickerSystem = new Entify.System('clicker');\nclickerSystem.work = async () => {\n  clickerSystem.clicks.forEach((click) => {\n    if (click[2] === 0) {\n      const size = getRandomInt(10) + 3;\n      const color = {\n        h : getRandomInt(360),\n        s : '60%', \n        l : '50%',\n      };\n      const position = {\n        x: click[0],\n        y: click[1],\n      };\n      const xSign = (!!getRandomInt(1)) ? 1 : -1;\n      const ySign = (!!getRandomInt(1)) ? 1 : -1;\n      const velocity = {\n        x: getRandomInt(6) + 1 * xSign,\n        y: getRandomInt(6) + 1 * ySign,\n      };\n      new Assemblages.Dot(size, color, position, velocity);\n    } else if (click[2] === 2) { // right click\n      Entify.allEntities.forEach((dot) => {\n        const [mouseX, mouseY] = click;\n        const { x, y } = dot.components.position;\n        const { radius } = dot.components.size;\n        const intersect = Math.hypot(mouseX-x, mouseY - y) <= (1 + radius);\n        if (intersect) {\n          Entify.Entity.destroy(dot.id);\n        }\n      });\n    }\n  });\n  clickerSystem.clicks.length = 0;\n};\n\nclickerSystem.setup = () => {\n  let mousedown = false;\n  clickerSystem.clicks = [];\n  Entify.globals.c.addEventListener('mousedown', (event) => {\n    mousedown = event.button;\n    clickerSystem.clicks.push([event.layerX, event.layerY, event.button]);\n  });\n  Entify.globals.c.addEventListener('mousemove', (event) => {\n    if (mousedown === 0 || mousedown === 2) {\n      clickerSystem.clicks.push([event.layerX, event.layerY, mousedown]);\n    }\n  });\n  Entify.globals.c.addEventListener('mouseup', () => {\n    mousedown = false;\n  });\n  Entify.globals.c.addEventListener('contextmenu', function(e) {\n    e.preventDefault();\n  });\n};\n\nexport default {\n  generatorSystem,\n  colliderSystem,\n  moverSystem,\n  drawerSystem,\n  clickerSystem,\n};","import Entify from '../../Entify.js';\nimport Systems from './systems.js';\n\nlet c;\n\nlet PAUSE_TXT = '&#10074; &#10074;';\nlet PLAY_TXT = '&#9654;';\n\n// Implementation\n\nEntify.globals.width = 800;\nEntify.globals.height = 600;\n\n// gonna use a canvas on the page\nc = document.getElementById('c');\nc.width = Entify.globals.width;\nc.height = Entify.globals.height;\nif (c.transferControlToOffscreen) {\n  Entify.globals.offscreen = true;\n} else {\n  Entify.globals.offscreen = false;\n}\n\n// now we need to pass the canvas/context into places that need it\nEntify.globals.c = c;\n// we can get c.width and height most places, but not in workers\n\n\n// initial numDots (changed with form on page)\nSystems.generatorSystem.numDots = 200;\n\n// register start systems\nEntify.startSystems = [Systems.generatorSystem];\n\n// register loop systems\nEntify.loopSystems = [\n  Systems.colliderSystem,\n  Systems.moverSystem,\n  Systems.drawerSystem,\n  Systems.clickerSystem,\n];\n\n// let's party!\nEntify.start();\n\n// let the user party!\ndocument.querySelector('#pause').addEventListener('click', (event) => {\n  if (Entify.playing) {\n    Entify.pause();\n    event.target.innerHTML = PLAY_TXT;\n  } else {\n    Entify.play();\n    event.target.innerHTML = PAUSE_TXT;\n  }\n});\ndocument.querySelector('#restart').addEventListener('click', async () => {\n  Entify.pause();\n  Systems.generatorSystem.numDots = parseInt(document.querySelector('#dotsInput').value);\n  Entify.globals.workerCount = parseInt(document.querySelector('#workersInput').value);\n  Entify.restart();\n  document.querySelector('#pause').innerHTML = PAUSE_TXT;\n});\n"]}